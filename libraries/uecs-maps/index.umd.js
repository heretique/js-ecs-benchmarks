!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).uECS={})}(this,(function(e){"use strict";class t{static for(e){const n=e.toString();let s=t.cache[n];return null==s&&(s=Object.defineProperty(class{},"name",{value:"T$"+n}),t.cache[n]=s),s}}t.cache={};class n{constructor(e,t){this.view=function(e,t){const n=t.length;let i="";const o=[];for(let e=0;e<n;++e){const n=t[e].name,r=`${s.storage}${n}`;i+=`const ${r} = ${s.world}.components["${n}"];\n`,o.push(r)}let r="";r+="let min = Infinity;\n",r+="let storage = undefined;\n";for(let e=0;e<n;++e)r+=`if (${o[e]}.size < min) {\n    storage = ${o[e]};\n    min = ${o[e]}.size;\n}\n`;r+="if (storage === undefined) return;\n",r+=`const ${s.entities} = storage.keys();\n`;let c="";const l=[];for(let e=0;e<n;++e){const n=`${t[e].name}${e}`;c+=`const ${n} = ${o[e]}.get(${s.entity});\n`,l.push(n)}let a="if (";for(let e=0;e<n;++e)a+=`${l[e]} === undefined`,e!==n-1&&(a+=" || ");a+=") continue;\n";const h=i+`return function(${s.callback}) {\n`+r+`for (const ${s.entity} of ${s.entities}) {\n`+c+a+`if (${s.callback}(${s.entity},${function(e,t){let n="";const s=e.length-1;for(let i=0;i<s;++i)n+=e[i]+t;return n+=e[s],n}(l,",")}) === false) return;\n}\n}`;return new Function(s.world,h)(e)}(e,t)}each(e){this.view(e)}}const s={world:"_$WORLD",entity:"_$ENTITY",entities:"_$ENTITIES",callback:"_$CALLBACK",storage:"_$STORAGE"};e.Null=-1,e.Tag=t,e.World=class{constructor(){this.entitySequence=0,this.entities=new Set,this.components={},this.views={}}create(...e){const t=this.entitySequence++;this.entities.add(t);for(let n=0,s=e.length;n<s;++n)this.emplace(t,e[n]);return t}insert(e,...t){e>=this.entitySequence&&(this.entitySequence=e+1),this.entities.add(e);for(let n=0,s=t.length;n<s;++n)this.emplace(e,t[n]);return e}exists(e){return this.entities.has(e)}destroy(e){this.entities.delete(e);for(const t in this.components){const n=this.components[t],s=n.get(e);void 0!==s&&void 0!==s.free&&s.free(),n.delete(e)}}get(e,t){const n=t.name,s=this.components[n];if(void 0!==s)return s.get(e)}has(e,t){const n=t.name,s=this.components[n];return void 0!==s&&s.has(e)}emplace(e,t){var n;const s=null!==(n=t.name)&&void 0!==n?n:t.constructor.name;if(!this.entities.has(e))throw new Error(`Cannot set component "${s}" for dead entity ID ${e}`);let i=this.components[s];void 0===i&&(i=new Map,this.components[s]=i),i.set(e,t)}remove(e,t){const n=t.name,s=this.components[n];if(void 0===s)return;const i=s.get(e);return s.delete(e),i}size(){return this.entities.size}view(...e){let t="";for(let n=0;n<e.length;++n)t+=e[n].name;if(!(t in this.views)){for(let t=0;t<e.length;++t)void 0===this.components[e[t].name]&&(this.components[e[t].name]=new Map);this.views[t]=new n(this,e)}return this.views[t]}clear(){for(const e of this.entities.values())this.destroy(e)}all(){return this.entities.values()}},Object.defineProperty(e,"__esModule",{value:!0})}));
