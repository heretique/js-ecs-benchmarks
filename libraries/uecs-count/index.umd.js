!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).uECS={})}(this,(function(t){"use strict";class e{constructor(t,e){this.view=function(t,e){const o=e.length;let s="";const i=[],c=[];for(let t=0;t<o;++t){const o=e[t].name,r=`${n.storage}${o}`;s+=`const ${r} = ${n.world}.components["${o}"];\n`,i.push(r);const l=`${r}Components`;s+=`const ${l} = ${r}.components;\n`,c.push(l)}let r="";r+="let min = Infinity;\n",r+="let storage = undefined;\n";for(let t=0;t<o;++t)r+=`if (${i[t]}.count < min) {\n    storage = ${i[t]};\n    min = ${i[t]}.count;\n}\n`;r+="if (storage === undefined) return;\n",r+=`const ${n.entities} = Object.keys(storage.components);\n`;let l="";const u=[];for(let t=0;t<o;++t){const o=`${e[t].name}${t}`;l+=`const ${o} = ${c[t]}[${n.entity}];\n`,u.push(o)}let a="if (";for(let t=0;t<o;++t)a+=`${u[t]} === undefined`,t!==o-1&&(a+=" || ");a+=") continue;\n";const h=s+`return function(${n.callback}) {\n`+r+`for (const ${n.entity} of ${n.entities}) {\n`+l+a+`if (${n.callback}(parseInt(${n.entity}),${function(t,e){let n="";const o=t.length-1;for(let s=0;s<o;++s)n+=t[s]+e;return n+=t[o],n}(u,",")}) === false) return;\n}\n}`;return new Function(n.world,h)(t)}(t,e)}each(t){this.view(t)}}const n={world:"_$WORLD",entity:"_$ENTITY",entities:"_$ENTITIES",callback:"_$CALLBACK",storage:"_$STORAGE",components:"_$COMPONENTS"};class o{static for(t){const e=t.toString();let n=o.cache[e];return null==n&&(n=Object.defineProperty(class{},"name",{value:"T$"+e}),o.cache[e]=n),n}}o.cache={},t.Null=-1,t.Tag=o,t.World=class{constructor(){this.entitySequence=0,this.entities=new Set,this.components={},this.views={}}create(...t){const e=this.entitySequence++;this.entities.add(e);for(let n=0,o=t.length;n<o;++n)this.emplace(e,t[n]);return e}insert(t,...e){t>=this.entitySequence&&(this.entitySequence=t+1),this.entities.add(t);for(let n=0,o=e.length;n<o;++n)this.emplace(t,e[n]);return t}exists(t){return this.entities.has(t)}destroy(t){this.entities.delete(t);for(const e in this.components){const n=this.components[e],o=n.components[t];void 0!==o&&(n.count--,void 0!==o.free&&o.free()),delete n.components[t]}}get(t,e){const n=e.name,o=this.components[n];if(void 0!==o)return o.components[t]}has(t,e){const n=e.name,o=this.components[n];return void 0!==o&&void 0!==o.components[t]}emplace(t,e){var n;const o=null!==(n=e.name)&&void 0!==n?n:e.constructor.name;if(!this.entities.has(t))throw new Error(`Cannot set component "${o}" for dead entity ID ${t}`);let s=this.components[o];void 0===s&&(this.components[o]={components:{},count:0},s=this.components[o]),void 0===s.components[t]&&s.count++,s.components[t]=e}remove(t,e){const n=e.name,o=this.components[n];if(void 0===o)return;const s=o.components[t];return void 0!==s&&o.count--,delete o.components[t],s}size(){return this.entities.size}view(...t){let n="";for(let e=0;e<t.length;++e)n+=t[e].name;if(!(n in this.views)){for(let e=0;e<t.length;++e)void 0===this.components[t[e].name]&&(this.components[t[e].name]={components:{},count:0});this.views[n]=new e(this,t)}return this.views[n]}clear(){for(const t of this.entities.values())this.destroy(t)}all(){return this.entities.values()}},Object.defineProperty(t,"__esModule",{value:!0})}));
