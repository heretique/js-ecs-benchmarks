"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class t{constructor(t,r){this.view=function(t,r){const c=r.length;let h=`const ${o} = []\n`;const l=[];for(let t=0;t<c;++t){const n=r[t].name,s=`${o}${n}`;h+=`const ${s} = ${e}.components["${n}"];\n${o}.push(${s});\n`,l.push(s)}let a="";const u=[];for(let t=0;t<c;++t){const e=`${r[t].name}${t}`;a+=`const ${e} = ${l[t]}[${n}];\n`,u.push(e)}let f="if (";for(let t=0;t<c;++t)f+=`${u[t]} === undefined`,t!==c-1&&(f+=" || ");f+=") continue;\n";const $=h+`return function(${i}) {\nlet index = 0;\nlet min = Math.Infinity;\n`+`for (let i = 0;  i < ${o}.length; i++) {\n`+`const length = ${o}[i].length;\nif (length < min) { min = length; index = i;}\n}\n`+`const ${s} = Object.keys(${o}[index]);\n`+`for (const ${n} of ${s}) {\n`+a+f+`if (${i}(${n},${function(t,e){let n="";const s=t.length-1;for(let i=0;i<s;++i)n+=t[i]+e;return n+=t[s],n}(u,",")}) === false) return;\n}\n}`;return new Function(e,$)(t)}(t,r)}each(t){this.view(t)}}const e="_$WORLD",n="_$ENTITY",s="_$ENTITIES",i="_$CALLBACK",o="_$STORAGE";class r{static for(t){const e=t.toString();let n=r.cache[e];return null==n&&(n=Object.defineProperty(class{},"name",{value:"T$"+e}),r.cache[e]=n),n}}r.cache={},exports.Null=-1,exports.Tag=r,exports.World=class{constructor(){this.entitySequence=0,this.entities=new Set,this.components={},this.views={}}create(...t){const e=this.entitySequence++;this.entities.add(e);for(let n=0,s=t.length;n<s;++n)this.emplace(e,t[n]);return e}insert(t,...e){t>=this.entitySequence&&(this.entitySequence=t+1),this.entities.add(t);for(let n=0,s=e.length;n<s;++n)this.emplace(t,e[n]);return t}exists(t){return this.entities.has(t)}destroy(t){this.entities.delete(t);for(const e in this.components){const n=this.components[e],s=n[t];void 0!==s&&void 0!==s.free&&s.free(),delete n[t]}}get(t,e){const n=e.name,s=this.components[n];if(void 0!==s)return s[t]}has(t,e){const n=e.name,s=this.components[n];return void 0!==s&&void 0!==s[t]}emplace(t,e){var n;const s=null!==(n=e.name)&&void 0!==n?n:e.constructor.name;if(!this.entities.has(t))throw new Error(`Cannot set component "${s}" for dead entity ID ${t}`);null==this.components[s]&&(this.components[s]={}),this.components[s][t]=e}remove(t,e){const n=e.name,s=this.components[n];if(void 0===s)return;const i=s[t];return delete s[t],i}size(){return this.entities.size}view(...e){let n="";for(let t=0;t<e.length;++t)n+=e[t].name;if(!(n in this.views)){for(let t=0;t<e.length;++t)void 0===this.components[e[t].name]&&(this.components[e[t].name]={});this.views[n]=new t(this,e)}return this.views[n]}clear(){for(const t of this.entities.values())this.destroy(t)}all(){return this.entities.values()}};
