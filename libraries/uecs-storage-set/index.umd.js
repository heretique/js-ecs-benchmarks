!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).uECS={})}(this,(function(e){"use strict";class t{constructor(e,t){this.view=function(e,t){const c=t.length;let r=`const ${o} = []\n`;const l=[];for(let e=0;e<c;++e){const i=t[e].name,s=`${o}${i}`;r+=`const ${s} = ${n}.components["${i}"];\n${o}.push(${s});\n`,l.push(s)}let h="";const u=[];for(let e=0;e<c;++e){const n=`${t[e].name}${e}`;h+=`const ${n} = ${l[e]}[${i}];\n`,u.push(n)}let a="if (";for(let e=0;e<c;++e)a+=`${u[e]} === undefined`,e!==c-1&&(a+=" || ");a+=") continue;\n";const f=r+`return function(${s}) {\nlet index = 0;\nlet min = Math.Infinity;\n`+`for (let i = 0;  i < ${o}.length; i++) {\n`+`const length = ${o}[i].length;\nif (length < min) { min = length; index = i;}\n}\n`+`for (const ${i} of ${o}[index].entities.values()) {\n`+h+a+`if (${s}(${i},${function(e,t){let n="";const i=e.length-1;for(let s=0;s<i;++s)n+=e[s]+t;return n+=e[i],n}(u,",")}) === false) return;\n}\n}`;return new Function(n,f)(e)}(e,t)}each(e){this.view(e)}}const n="_$WORLD",i="_$ENTITY",s="_$CALLBACK",o="_$STORAGE";class c{static for(e){const t=e.toString();let n=c.cache[t];return null==n&&(n=Object.defineProperty(class{},"name",{value:"T$"+t}),c.cache[t]=n),n}}c.cache={},e.Null=-1,e.Tag=c,e.World=class{constructor(){this.entitySequence=0,this.entities=new Set,this.components={},this.views={}}create(...e){const t=this.entitySequence++;this.entities.add(t);for(let n=0,i=e.length;n<i;++n)this.emplace(t,e[n]);return t}insert(e,...t){e>=this.entitySequence&&(this.entitySequence=e+1),this.entities.add(e);for(let n=0,i=t.length;n<i;++n)this.emplace(e,t[n]);return e}exists(e){return this.entities.has(e)}destroy(e){this.entities.delete(e);for(const t in this.components){const n=this.components[t],i=n[e];void 0!==i&&void 0!==i.free&&i.free(),delete n[e],n.entities.delete(e)}}get(e,t){const n=t.name,i=this.components[n];if(void 0!==i)return i[e]}has(e,t){const n=t.name,i=this.components[n];return null==i?void 0:i.entities.has(e)}emplace(e,t){var n;const i=null!==(n=t.name)&&void 0!==n?n:t.constructor.name;if(!this.entities.has(e))throw new Error(`Cannot set component "${i}" for dead entity ID ${e}`);null==this.components[i]&&(this.components[i]={entities:new Set}),this.components[i][e]=t,this.components[i].entities.add(e)}remove(e,t){const n=t.name,i=this.components[n];if(void 0===i)return;const s=i[e];return delete i[e],i.entities.delete(e),s}size(){return this.entities.size}view(...e){let n="";for(let t=0;t<e.length;++t)n+=e[t].name;if(!(n in this.views)){for(let t=0;t<e.length;++t)void 0===this.components[e[t].name]&&(this.components[e[t].name]={entities:new Set});this.views[n]=new t(this,e)}return this.views[n]}clear(){for(const e of this.entities.values())this.destroy(e)}all(){return this.entities.values()}},Object.defineProperty(e,"__esModule",{value:!0})}));
